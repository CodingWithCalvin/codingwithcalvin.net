---
import type { GetStaticPaths } from 'astro';
import BaseLayout from '../../layouts/BaseLayout.astro';
import ProjectCard from '../../components/ProjectCard.astro';
import Pagination from '../../components/Pagination.astro';
import { getProjectsWithImages, getProjectSlug } from '../../lib/projects';

export const getStaticPaths = (async ({ paginate }) => {
  const allProjects = await getProjectsWithImages();
  // Sort by featured first, then by start date (newest first)
  const sortedProjects = allProjects.sort((a, b) => {
    if (a.data.featured !== b.data.featured) {
      return a.data.featured ? -1 : 1;
    }
    return b.data.startDate.getTime() - a.data.startDate.getTime();
  });

  return paginate(sortedProjects, { pageSize: 9 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<BaseLayout title="Open Source Projects" description="Open source projects by Calvin Allen">
  <section class="py-12">
    <div class="container mx-auto px-4">
      <h1 class="text-4xl font-heading mb-4">Open Source Projects</h1>
      <p class="text-text-muted text-lg mb-8">
        A collection of open source projects I've created and maintain.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {page.data.map(project => (
          <ProjectCard
            title={project.data.title}
            slug={getProjectSlug(project.id)}
            description={project.data.description}
            techStack={project.data.techStack}
            repoUrl={project.data.repoUrl}
            image={project.resolvedImage}
            stars={project.data.stars}
            downloads={project.data.downloads}
          />
        ))}
      </div>

      {page.lastPage > 1 && (
        <Pagination
          currentPage={page.currentPage}
          totalPages={page.lastPage}
          baseUrl="/projects/"
        />
      )}
    </div>
  </section>
</BaseLayout>
