---
import type { GetStaticPaths } from 'astro';
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import Pagination from '../../components/Pagination.astro';
import { getPostsWithImages, getSlug } from '../../lib/posts';

export const getStaticPaths = (async ({ paginate }) => {
  const allPosts = await getPostsWithImages();
  const sortedPosts = allPosts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

  return paginate(sortedPosts, { pageSize: 9 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<BaseLayout title="Blog" description="All blog posts from Coding With Calvin" image="/images/blog-og.png">
  <section class="py-12">
    <div class="container mx-auto px-4">
      <h1 class="text-4xl font-heading mb-8">Blog</h1>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {page.data.map(post => (
          <PostCard
            title={post.data.title}
            subtitle={post.data.subtitle}
            slug={getSlug(post.id)}
            date={post.data.date}
            description={post.data.description}
            categories={post.data.categories}
            image={post.resolvedImage}
          />
        ))}
      </div>

      {page.lastPage > 1 && (
        <Pagination
          currentPage={page.currentPage}
          totalPages={page.lastPage}
          baseUrl="/blog/"
        />
      )}
    </div>
  </section>
</BaseLayout>
